<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Tebom</title>
    <link rel="stylesheet" href="css/sweetalert2.css" media="screen" title="no title">
    <link rel="stylesheet" href="http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" media="screen" title="no title">
    <style media="screen">

      body {
        background-color: #fafafa;
      }

      hr {
        margin: 0px;
      }

      p {
        margin: 0;
      }

      content-item hr {
        margin: 12px 0;
      }

      content-item p {
        margin: 8px 0;
      }

      h1, h2, h3, h4, h5, h6 {
        margin: 0;
      }

      .toolbar {
        height: 48px;
        width: 1260px;
        position: fixed;
        top: 60px;
        left: 0;
        margin-left: calc((100% - 1200px)/2 - 60px);
        z-index: 10;
      }

      .tool-list {
        list-style: none;
        letter-spacing: -.40em;
        margin: 0;
        padding: 0;
      }

      .tool-item {
        display: inline-block;
        font-size: 13px;
        letter-spacing: normal;
        line-height: 48px;
        box-shadow: 0px 0px 2px rgba(0, 0, 0, 0.1);
        background-color: #fff;
        padding: 0 16px;
        cursor: pointer;
        -webkit-transition: all 0.3s ease;
        -moz-transition: all 0.3s ease;
        -o-transition: all 0.3s ease;
        transition: all  0.3s ease;
      }

      .tool-toggle-btn {
        display: inline-block;
        font-size: 13px;
        letter-spacing: normal;
        line-height: 48px;
        width: 60px;
        background-color: #fff;
        box-shadow: 0px 0px 2px rgba(0, 0, 0, 0.1);
        text-align: center;
        padding: 0px;
        cursor: pointer;
        -webkit-transition: all 0.3s ease;
        -moz-transition: all 0.3s ease;
        -o-transition: all 0.3s ease;
        transition: all  0.3s ease;
      }

      .tool-item:hover {
        background-color: #f9f9f9;
      }

      .preview-area {
        background-color: #fff;
        border: solid #eee 1px;
        width: 100%;
        height: auto;
        min-height: 600px;
        padding: 12px;
        box-sizing: border-box;
      }

      .alert-nothing {
        margin: 0;
        text-align: center;
        line-height: 200px;
        font-size: 24px;
        color: #333;
        background-color: #f5f5f5;
      }

      .pack {
        max-width: 1200px;
        margin: auto;
      }

      button {
        outline: none;
      }

      .hr-wrapper {
        padding: 4px 0;
      }

      hr{
        border-style: solid;
      }

      .swal2-file {
        padding: 20px;
      }

      .content-item {
        position: relative;
        width: 100%;
        cursor: pointer;
        white-space: pre-line;
        margin-bottom: 8px;
      }

      .edit-menu {
        position: absolute;
        top: 8px;
        right: 0;
        display: none;
      }

      .edit-menu i {
        font-size: 18px;
        margin: 0 4px;
        cursor: pointer;
        color: #333;
        background-color: #f5f5f5;
        width: 22px;
        height: 32px;
        border-radius: 50%;
        display: inline-block;
        padding-left: 10px;
        line-height: 32px;
      }

      .box-item {
        background-color: #eee;
        padding: 12px;
        border-radius: 4px;
        width: auto;
      }

      .box-item * {
        margin: 0;
      }

      .item-bold {
        font-weight: bold;
      }

      .preview {
        display: none;
        width: 924px;
        background-color: #fff;
        border: solid #eee 1px;
        height: auto;
        min-height: 600px;
        padding: 12px;
        box-sizing: border-box;
        position: relative;
        white-space: pre-line;
      }

      .remove-item {
        color: #CF000F;
      }


    </style>
  </head>
  <body>
  <div class="pack" style="margin-top: 108px;">
    <div class="toolbar">
      <ul class="tool-list">
        <div class="tool-toggle-btn"><i class="icon ion-close"></i></div>
        <li class="tool-item add-h1"><i class="icon ion-eye"></i>&nbsp;見出し</li>
        <li class="tool-item add-p"><i class="icon ion-edit"></i>&nbsp;文章</li>
        <li class="tool-item add-img"><i class="icon ion-android-upload"></i>&nbsp;画像アップロード</li>
        <li class="tool-item add-img-url"><i class="icon ion-image"></i>&nbsp;画像(URL)</li>
        <li class="tool-item add-line"><i class="icon ion-minus"></i>&nbsp;ライン</li>
        <li class="tool-item show-preview"><i class="icon ion-eye"></i>&nbsp;プレビュー</li>
        <li class="tool-item remove-item"><i class="icon ion-trash-b"></i>&nbsp;削除</li>
      </ul>
    </div>
    <div class="row">
      <div class="twelve cols">
        <div class="preview-area">
        </div>
        <div class="preview">
          <p style="position: absolute; top: 8px; right: 8px">
            <i class="icon ion-eye"></i>&nbsp;プレビュー中
          </p>
          <div class="preview-inner">

          </div>
        </div>
      </div>
    </div>
  </div>

    <script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>
    <script src="js/sweetalert2.min.js" charset="utf-8"></script>
    <script type="text/javascript">

      $(document).on('click','.ion-trash-b',function(){
        var that = $(this);
        var targetContent = $(this).parents('.content-item').find('.inner-item').html();

        if (targetContent.length > 8) {
          swal({
            title: 'この要素を削除しますか？',
            text: "削除した要素は元に戻せません。",
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            confirmButtonText: '削除',
            cancelButtonText: 'キャンセル',
          }).then(function() {
            that.parents(".content-item").remove();
          })
        } else {
          that.parents(".content-item").remove();
        }
      });

      $(document).on('click','.ion-edit',function(){
        var self = $(this).parents('.content-item');
        var mirror = self.find('.inner-item');

        switch (self.data('type')) {
          case 'h1':
            swal({
              title: '見出しを編集',
              input: 'text',
              inputValue: mirror.text(),
              showCancelButton: true,
              confirmButtonText: "挿入",
              confirmButtonColor: "#3085d6",
              cancelButtonText: "キャンセル",
              inputValidator: function(value) {
                return new Promise(function(resolve, reject) {
                  if (value) {
                    resolve();
                  } else {
                    reject('見出しを入力してください');
                  }
                });
              }
            }).then(function(result) {
              self.after("<div class='content-item'><h1 class='inner-item'>" + result + "</h1><div class='edit-menu'><i class='icon ion-edit'></i><i class='icon ion-arrow-expand'></i><i class='icon ion-arrow-shrink'></i><i class='icon ion-android-color-palette'></i><i class='icon ion-trash-b'></i><i class='icon ion-link'></i><i class='icon ion-arrow-up-b'></i><i class='icon ion-arrow-down-b'></i></div></div>");
              self.remove();
              swal.close();
            });
            break;
          case 'p':
            swal({
              title: '文章を編集',
              input: 'textarea',
              inputValue: mirror.text(),
              width: 1000,
              showCancelButton: true,
              confirmButtonText: "挿入",
              confirmButtonColor: "#3085d6",
              cancelButtonText: "キャンセル",
              inputValidator: function(value) {
                return new Promise(function(resolve, reject) {
                  if (value) {
                    resolve();
                  } else {
                    reject('文章を入力してください');
                  }
                });
              }
            }).then(function(result) {
              self.after("<div class='content-item'><p class='inner-item'>" + result + "</p><div class='edit-menu'><i class='icon ion-edit'></i><i class='icon ion-paintbrush></i><i class='icon ion-arrow-expand'></i><i class='icon ion-arrow-shrink'></i><i class='icon ion-android-checkbox-blank'></i><i class='icon ion-trash-b'></i><i class='icon ion-link'></i><i class='icon ion-arrow-up-b'></i><i class='icon ion-arrow-down-b'></i></div></div>");
              self.remove();
              swal.close();
            })
            break;

          default:
            alert(self.data('type'));
            break;
        }
      });

      $(document).on('click','.ion-paintbrush',function(){
        var self = $(this).parents('.content-item');
        var item = self.find('.inner-item');

        item.toggleClass('item-bold');
        return false;
      });

      $(document).on('click','.ion-link',function(){
        var self = $(this).parents('.content-item');
        var item = self.find('.inner-item');

        swal({
          title: 'リンクを作成',
          input: 'text',
          showCancelButton: true,
          confirmButtonText: "リンクを挿入",
          confirmButtonColor: "#3085d6",
          cancelButtonText: "キャンセル",
          inputValidator: function(value) {
            return new Promise(function(resolve, reject) {
              if (value) {
                resolve();
              } else {
                reject('見出しを入力してください');
              }
            });
          }
        }).then(function(result) {
          item.unwrap("a");
          item.wrap("<a href='" + result + "'></a>");
        });

        return false;
      });

      $(document).on('click','.ion-arrow-up-b',function(){
        var self = $(this).parents('.content-item');
        var prev = $(this).parents('.content-item').prev();
        var prevHtml = prev.html();
        if(prevHtml === undefined){
          swal({title: "最初の要素です。", timer: 600});
        } else {
          prev.before(self.prop('outerHTML'));
          self.remove();
        }
        return false;
      });

      $(document).on('click','.ion-arrow-down-b',function(){
        var self = $(this).parents('.content-item');
        var next = $(this).parents('.content-item').next();
        var nextHtml = next.html();
        if(nextHtml === undefined){
          swal({title: "最後の要素です。", timer: 600});
        } else {
          next.after(self.prop('outerHTML'));
          self.remove();
        }
        return false;
      });

      $(document).on('click','.ion-arrow-expand',function(){
        var self = $(this).parents('.content-item');
        var item = self.find('.inner-item');

        if (self.data('type') == 'hr') {
          var itemBorderWidth = item.css('border-width');
          var newitemBorderWidth = parseInt(itemBorderWidth) + 1;

          item.css('border-width', newitemBorderWidth);
        } else {
          var itemFontSize = item.css('font-size');
          var newitemFontSize = parseInt(itemFontSize) + 2;

          item.css('font-size', newitemFontSize);
        }

        return false;
      });

      $(document).on('click','.ion-arrow-shrink',function(){
        var self = $(this).parents('.content-item');
        var item = self.find('.inner-item');

        if (self.data('type') == 'hr') {
          var itemBorderWidth = item.css('border-width');
          var newitemBorderWidth = parseInt(itemBorderWidth) - 1;

          item.css('border-width', newitemBorderWidth);
        } else {
          var itemFontSize = item.css('font-size');
          var newitemFontSize = parseInt(itemFontSize) - 2;

          item.css('font-size', newitemFontSize);
        }

        return false;
      });

      $(document).on('click','.ion-android-color-palette',function(){
        var that = $(this);
        var mirror = "<h3 class='mirror'>" + $(this).parents('.content-item').find('.inner-item').text() + "</h3>";

        swal({
          title: '色を選択',
          input: 'select',
          inputOptions: {
            '#999': 'Grey',
            '#CF000F': 'Red',
            '#2C82C9': 'Blue',
            '#71BA51': 'Green',
            '#282830': 'Black',
            '#EEE657': 'Yellow',
            '#FD5B03': 'Orange',
            '#523D1F': 'Brown',
            '#D33257': 'Pink',
            '#ffffff': 'white',
          },
          text: mirror,
          inputPlaceholder: '色を選択',
          showCancelButton: true,
        }).then(function(result) {
          var self = $(that).parents('.content-item');
          var target = self.find('.inner-item');
          target.css('color', result);
          target.attr('color', result);
        })
      });

      $(".add-h1").click(function(){
        swal({
          title: '見出しを入力',
          input: 'text',
          showCancelButton: true,
          confirmButtonText: "挿入",
          confirmButtonColor: "#3085d6",
          cancelButtonText: "キャンセル",
          inputValidator: function(value) {
            return new Promise(function(resolve, reject) {
              if (value) {
                resolve();
              } else {
                reject('見出しを入力してください');
              }
            });
          }
        }).then(function(result) {
          $(".preview-area").append("<div class='content-item' data-type='h1'><h1 class='inner-item'>" + result + "</h1><div class='edit-menu'><i class='icon ion-edit'></i><i class='icon ion-arrow-expand'></i><i class='icon ion-arrow-shrink'></i><i class='icon ion-android-color-palette'></i><i class='icon ion-trash-b'></i><i class='icon ion-link'></i><i class='icon ion-arrow-up-b'></i><i class='icon ion-arrow-down-b'></i></div></div>");
          swal.close();
        })
      });

      $(".add-box").click(function(){
        swal({
          title: 'ボックスを作成',
          input: 'textarea',
          width: 1000,
          showCancelButton: true,
          confirmButtonText: "挿入",
          confirmButtonColor: "#3085d6",
          cancelButtonText: "キャンセル",
          inputValidator: function(value) {
            return new Promise(function(resolve, reject) {
              if (value) {
                resolve();
              } else {
                reject('文章を入力してください');
              }
            });
          }
        }).then(function(result) {
          $(".preview-area").append("<div class='content-item box-item' data-type='box'><p class='inner-item'>" + result + "</p><div class='edit-menu'><i class='icon ion-edit'></i><i class='icon ion-arrow-expand'></i><i class='icon ion-arrow-shrink'></i><i class='icon ion-trash-b'></i><i class='icon ion-link'></i><i class='icon ion-arrow-up-b'></i><i class='icon ion-arrow-down-b'></i></div></div>");
          swal.close();
        })
      });

      $(".add-p").click(function(){
        swal({
          title: '文章を入力',
          input: 'textarea',
          width: 1000,
          showCancelButton: true,
          confirmButtonText: "挿入",
          confirmButtonColor: "#3085d6",
          cancelButtonText: "キャンセル",
          inputValidator: function(value) {
            return new Promise(function(resolve, reject) {
              if (value) {
                resolve();
              } else {
                reject('文章を入力してください');
              }
            });
          }
        }).then(function(result) {
          $(".preview-area").append("<div class='content-item' data-type='p'><p class='inner-item'>" + result + "</p><div class='edit-menu'><i class='icon ion-edit'></i><i class='icon ion-paintbrush'></i><i class='icon ion-arrow-expand'></i><i class='icon ion-arrow-shrink'></i><i class='icon ion-android-color-palette'></i><i class='icon ion-trash-b'></i><i class='icon ion-link'></i><i class='icon ion-arrow-up-b'></i><i class='icon ion-arrow-down-b'></i></div></div>");
          swal.close();
        })
      });

      $(".add-img").click(function(){
        swal({
          title: '画像をアップロード',
          input: 'file',
          inputAttributes: {
            accept: 'image/*'
          }
        }).then(function(file) {
          var reader = new FileReader;
          reader.onload = function(e) {
            $(".preview-area").append("<div class='content-item' data-type='img'><img style='max-width: 900px;' class='inner-item' src='" + e.target.result + "'><div class='edit-menu'><i class='icon ion-trash-b'></i><i class='icon ion-link'></i><i class='icon ion-arrow-up-b'></i><i class='icon ion-arrow-down-b'></i></div></div>");
            swal.close();
          };
          reader.readAsDataURL(file);
        })
      });

      $(".add-img-url").click(function(){
        swal({
          title: '画像のURLを入力',
          input: 'text',
          showCancelButton: true,
          confirmButtonText: "挿入",
          confirmButtonColor: "#3085d6",
          cancelButtonText: "キャンセル",
          inputValidator: function(value) {
            return new Promise(function(resolve, reject) {
              if (value) {
                resolve();
              } else {
                reject('文章を入力してください');
              }
            });
          }
        }).then(function(result) {
          $(".preview-area").append("<div class='content-item' data-type='img-url'><img style='max-width: 900px' class='inner-item' src='" + result + "'><div class='edit-menu'><a class='edit-item'><i class='icon ion-edit'></i></a><i class='icon ion-trash-b'></i><i class='icon ion-link'></i><i class='icon ion-arrow-up-b'></i><i class='icon ion-arrow-down-b'></i></div></div>");
          swal.close();
        })
      });

      $(".add-line").click(function(){
        $(".preview-area").append("<div class='content-item hr-wrapper' data-type='hr'><hr class='inner-item' /><div class='edit-menu'><i class='icon ion-arrow-expand'></i><i class='icon ion-arrow-shrink'></i><i class='icon ion-android-color-palette'></i><i class='icon ion-trash-b'></i><i class='icon ion-link'></i><i class='icon ion-arrow-up-b'></i><i class='icon ion-arrow-down-b'></i></div></div>");
      });

      $(document).on('click','.content-item',function(){
        $(".edit-menu").hide();
        $(this).find(".edit-menu").toggle();
      });

      $('.tool-toggle-btn').click(function(){
        $(this).find(".icon").toggleClass("ion-plus");
        $(this).find(".icon").toggleClass("ion-close");
        $('.tool-item').toggle();
      });

      $(function($) {
        $('.swal2-select').change(function() {
          $('.mirror').css('color', $('.swal2-select').val());
        });
      });

      $('.show-preview').click(function(){
        var content = $('.preview-area').html();
        $('.edit-menu').remove();
        var contentItem = $('.preview-area').find('.content-item');
        contentItem.removeAttr("data-type");
        contentItem.removeClass("content-item");

        $('.preview-area').toggle();

        $('.hr-wrapper').css('padding', '0')
        $('.preview-inner').html($('.preview-area').html());
        $('.preview').toggle();

        $('.preview-area').html(content);
      });

      $('.remove-item').click(function(){
        swal({
          title: '内容を全て削除しますか？',
          text: "削除した要素は元に戻せません。",
          type: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#d33',
          confirmButtonText: '削除',
          cancelButtonText: 'キャンセル',
        }).then(function() {
          $('.preview-area').empty();
        });
      });

    </script>
  </body>
</html>
